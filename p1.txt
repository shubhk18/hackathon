#!/bin/bash

# Set variables for the MQ environment
MQ_MANAGER="YOUR_QUEUE_MANAGER"
MQ_QUEUE="YOUR_QUEUE_NAME"
MQ_HOST="YOUR_MQ_HOST"
MQ_PORT="YOUR_MQ_PORT"
MQ_CHANNEL="YOUR_CHANNEL_NAME"
MQ_USER="YOUR_USERNAME"        # Only if authentication is needed
MQ_PASSWORD="YOUR_PASSWORD"    # Only if authentication is needed
FILES_DIR="/path/to/files"     # Directory containing files to send

# Function to send a file to the queue
send_file_to_mq() {
    local file_path=$1

    # Using amqsput to put message into queue
    cat "$file_path" | /opt/mqm/samp/bin/amqsput $MQ_QUEUE $MQ_MANAGER << EOF
$MQ_HOST
$MQ_PORT
$MQ_CHANNEL
$MQ_USER
$MQ_PASSWORD
EOF

    if [ $? -eq 0 ]; then
        echo "File '$file_path' successfully sent to queue '$MQ_QUEUE'."
    else
        echo "Failed to send file '$file_path' to queue."
    fi
}

# Check if the directory exists and has files
if [[ -d "$FILES_DIR" ]] && [[ $(ls -A "$FILES_DIR") ]]; then
    # Loop through each file in the directory and send it to the MQ queue
    for file in "$FILES_DIR"/*; do
        if [[ -f "$file" ]]; then
            echo "Sending file '$file' to MQ..."
            send_file_to_mq "$file"
        else
            echo "'$file' is not a regular file and will be skipped."
        fi
    done
else
    echo "Directory $FILES_DIR does not exist or is empty."
fi