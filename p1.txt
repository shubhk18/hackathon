import csv
import xml.etree.ElementTree as ET

# Function to extract XML content and remove <tag3>
def extract_xml(xml_string):
    root = ET.fromstring(xml_string)
    for tag in root.findall('tag3'):
        root.remove(tag)
    return ET.tostring(root, encoding='unicode', method='xml')

# Read input CSV file and process rows
input_file = 'input.csv'
output_file = 'output.csv'
unique_xml = set()
filtered_rows = []

with open(input_file, 'r', newline='') as csvfile:
    csvreader = csv.reader(csvfile)
    next(csvreader)  # Skip header if there's any

    for row in csvreader:
        xml_content = row[3]
        extracted_xml = extract_xml(xml_content)

        if extracted_xml not in unique_xml:
            unique_xml.add(extracted_xml)
            filtered_rows.append(row)

# Write filtered rows to output CSV file
with open(output_file, 'w', newline='') as csvfile:
    csvwriter = csv.writer(csvfile)
    csvwriter.writerows(filtered_rows)

print(f"Filtered output saved to '{output_file}'")
