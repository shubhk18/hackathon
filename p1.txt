import csv
import xml.etree.ElementTree as ET

def extract_xml_from_line(line):
    fields = line.strip().split(',')
    xml_string = ','.join(fields[3:])
    
    # Remove <tag3>...</tag3> from the XML string
    xml_tree = ET.fromstring(xml_string)
    for tag3_elem in xml_tree.findall('.//tag3'):
        tag3_elem.getparent().remove(tag3_elem)
    
    modified_xml_string = ET.tostring(xml_tree, encoding='unicode', method='xml')
    return modified_xml_string

def main(input_file, output_file):
    unique_xml_set = set()

    with open(input_file, 'r') as csv_file:
        csv_reader = csv.reader(csv_file)
        
        for row in csv_reader:
            if len(row) < 4:
                continue
            
            xml_content = extract_xml_from_line(','.join(row))
            
            if xml_content not in unique_xml_set:
                unique_xml_set.add(xml_content)
                with open(output_file, 'a') as out_file:
                    out_file.write(','.join(row) + '\n')

if __name__ == "__main__":
    input_file = 'input.csv'  # Replace with your input CSV file
    output_file = 'output.csv'  # Replace with your output CSV file
    main(input_file, output_file)
